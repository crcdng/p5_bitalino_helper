<!DOCTYPE html>
<html>
  <head>
    <title>BITalino to A-Frame</title>
    <script src="js/aframe.js"></script>
    <script src="js/osc.js"></script>
  </head>
  <body>
    <a-scene light="defaultLightsEnabled: false">
      <a-entity light="type: spot; angle: 45"></a-entity>
      <a-box id="box" position="-1 0.5 -3" rotation="0 45 0" color="#4CC3D9"></a-box>
      <a-sphere id="sphere" position="0 1.25 -5" radius="1.25" color="#EF2D5E"></a-sphere>
      <a-cylinder position="1 0.75 -3" radius="0.5" height="1.5" color="#FFC65D"></a-cylinder>
      <a-plane position="0 0 -4" rotation="-90 0 0" width="4" height="4" color="#7BC8A4"></a-plane>
      <a-sky color="#ECECEC"></a-sky>
    </a-scene>
    <!-- This could become a proper A-Frame component in the future -->
    <script type="text/javascript">
      const boxEl = document.querySelector('#box');
      const sphereEl = document.querySelector('#sphere');

      const osc = new OSC();
      const connectionMessage = new OSC.Message('/aframe/connect');
      osc.on('open', () => {
        osc.send(connectionMessage);
      });
      osc.on('/aframe/inputs', message => {
        const eda = message.args[0];
        const eeg = message.args[1];
        // console.log(eda, eeg);
        const scaleFactor = 1 + 3 * eda;
        const colorValue = parseInt(parseFloat(eeg) * 256);
        const colorString = (colorValue < 16) ? "0" + colorValue.toString(16) : colorValue.toString(16);
        boxEl.object3D.scale.set(scaleFactor, scaleFactor, scaleFactor);
        sphereEl.setAttribute('material', 'color', '#'+colorString+'2D5E');
      });
      osc.open();
    </script>
  </body>
</html>
